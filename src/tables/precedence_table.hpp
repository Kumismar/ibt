#pragma once

#include "token.hpp"
#include <cstring>
#include <vector>

#define ROWSIZE 19

class PrecRowAccessor
{
private:
    char precTableRow[ROWSIZE];

public:
    PrecRowAccessor(const char r[])
    {
        std::strncpy(this->precTableRow, r, ROWSIZE);
    }

    char operator[](const Token& t);
};

class PrecedenceTable
{
private:
    static constexpr char precTable[ROWSIZE][ROWSIZE] = {
        // +    -    *    /    .   &&   ||   ==   !=    >    <   >=   <=    (    )    !  un -   $    i
        { '>', '>', '<', '<', '<', '>', '>', '>', '>', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // +
        { '>', '>', '<', '<', '<', '>', '>', '>', '>', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // -
        { '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // *
        { '>', '>', '<', '<', '<', '>', '>', '>', '>', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // /
        { '>', '>', '<', '<', '>', '>', '>', '>', '>', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // .
        { '<', '<', '<', '<', '<', '>', '>', '>', '>', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // &&
        { '<', '<', '<', '<', '<', '<', '>', '>', '>', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // ||
        { '<', '<', '<', '<', '<', '<', '<', '>', '>', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // ==
        { '<', '<', '<', '<', '<', '<', '<', '>', '>', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // !=
        { '<', '<', '<', '<', '<', '<', '<', '<', '<', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // >
        { '<', '<', '<', '<', '<', '<', '<', '<', '<', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // <
        { '<', '<', '<', '<', '<', '<', '<', '<', '<', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // >=
        { '<', '<', '<', '<', '<', '<', '<', '<', '<', '>', '>', '>', '>', '<', '>', '<', '<', '>', '<' }, // <=
        { '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '=', '<', '<', '>', '<' }, // (
        { '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', 'x', '>', 'x', 'x', '>', 'x' }, // )
        { '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '<', '>', '>', '>', '>', '<' }, // !
        { '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '<', '>', '>', '>', '>', '<' }, // unary -
        { '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', 'x', '<', '<', 'x', '<' }, // $
        { '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', 'x', '>', 'x', 'x', '>', 'x' }, // i
    };


public:
    PrecRowAccessor operator[](const Token& t) const;
    static unsigned MapTokenToIndex(const Token& t);
};